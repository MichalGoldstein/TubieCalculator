<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calorie Calculator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        select, input, button {
            margin: 10px 0;
            display: block;
        }
    </style>
</head>
<body>
    <h1>Calorie Calculator</h1>
    
    <!-- Dropdowns -->
    <label for="brandSelect">Choose a brand:</label>
    <select id="brandSelect">
        <option value="" selected disabled>Select a brand</option>
    </select>

    <label for="formulaSelect">Choose a formula:</label>
    <select id="formulaSelect" disabled>
        <option value="" selected disabled>Select a formula</option>
    </select>

    <!-- Output -->
    <h2>Calorie Content: <span id="calorieContent">N/A</span> kcal/ml</h2>

    <!-- Calorie Goal Input -->
    <label for="calorieGoal">Enter your calorie goal:</label>
    <input type="number" id="calorieGoal" placeholder="Calorie goal in kcal">
    <button id="calculateVolumeBtn">Calculate Volume</button>
    <h2>Volume Required: <span id="volumeRequired">N/A</span> ml</h2>

    <!-- Rate/Time Calculations -->
    <label for="infusionHours">Enter hours to infuse:</label>
    <input type="number" id="infusionHours" placeholder="Infusion hours">
    <button id="calculateRateBtn">Calculate Rate</button>
    <h2>Rate Required: <span id="rateRequired">N/A</span> ml/hr</h2>

    <label for="infusionRate">Enter infusion rate (ml/hr):</label>
    <input type="number" id="infusionRate" placeholder="Infusion rate">
    <button id="calculateTimeBtn">Calculate Time</button>
    <h2>Time Required: <span id="timeRequired">N/A</span> hours</h2>

    <script>
        let data = {}; // Store the data

        // Fetch data.json
        fetch('data.json')
            .then(response => response.json())
            .then(json => {
                data = json;
                populateBrands();
            })
            .catch(err => console.error('Error loading data.json:', err));

        const brandSelect = document.getElementById('brandSelect');
        const formulaSelect = document.getElementById('formulaSelect');
        const calorieContent = document.getElementById('calorieContent');
        const volumeRequired = document.getElementById('volumeRequired');
        const rateRequired = document.getElementById('rateRequired');
        const timeRequired = document.getElementById('timeRequired');

        // Populate the brand dropdown
        function populateBrands() {
            Object.keys(data).forEach(brand => {
                const option = document.createElement('option');
                option.value = brand;
                option.textContent = brand;
                brandSelect.appendChild(option);
            });
        }

        // Populate the formula dropdown based on selected brand
        brandSelect.addEventListener('change', () => {
            formulaSelect.innerHTML = '<option value="" selected disabled>Select a formula</option>';
            formulaSelect.disabled = false;

            const selectedBrand = brandSelect.value;
            const formulas = data[selectedBrand];
            Object.keys(formulas).sort().forEach(formula => {
                const option = document.createElement('option');
                option.value = formulas[formula];
                option.textContent = formula;
                formulaSelect.appendChild(option);
            });
        });

        // Update calorie content when formula is selected
        formulaSelect.addEventListener('change', () => {
            calorieContent.textContent = formulaSelect.value;
        });

        // Calculate volume required
        document.getElementById('calculateVolumeBtn').addEventListener('click', () => {
            const goal = parseFloat(document.getElementById('calorieGoal').value);
            const calPerMl = parseFloat(formulaSelect.value);
            if (!isNaN(goal) && !isNaN(calPerMl)) {
                volumeRequired.textContent = (goal / calPerMl).toFixed(2);
            } else {
                volumeRequired.textContent = 'N/A';
            }
        });

        // Calculate rate required
        document.getElementById('calculateRateBtn').addEventListener('click', () => {
            const hours = parseFloat(document.getElementById('infusionHours').value);
            const goal = parseFloat(document.getElementById('calorieGoal').value);
            const calPerMl = parseFloat(formulaSelect.value);
            if (!isNaN(hours) && !isNaN(goal) && !isNaN(calPerMl)) {
                const volume = goal / calPerMl;
                rateRequired.textContent = (volume / hours).toFixed(2);
            } else {
                rateRequired.textContent = 'N/A';
            }
        });

        // Calculate time required
        document.getElementById('calculateTimeBtn').addEventListener('click', () => {
            const rate = parseFloat(document.getElementById('infusionRate').value);
            const goal = parseFloat(document.getElementById('calorieGoal').value);
            const calPerMl = parseFloat(formulaSelect.value);
            if (!isNaN(rate) && !isNaN(goal) && !isNaN(calPerMl)) {
                const volume = goal / calPerMl;
                timeRequired.textContent = (volume / rate).toFixed(2);
            } else {
                timeRequired.textContent = 'N/A';
            }
        });
    </script>
</body>
</html>
